{"version":3,"file":"TextElement.js","sources":["../../../src/elements/TextElement.svelte","../../src/pages/elements/TextElement.svx"],"sourcesContent":["<script>\n  import { getContext, onMount } from 'svelte';\n\n  import PIXI, { PIXI_CONTEXT, DragManager, WarpContainer } from '../lib/pixi/index.js';\n\n  export let text,\n    x,\n    y,\n    width,\n    height,\n    style = {\n      opacity: 1,\n      scale: 1,\n    },\n    textStyle = {},\n    fontSize = 26,\n    fill = 0x000000;\n\n  const { getApp, pixiStore } = getContext(PIXI_CONTEXT);\n  const app = getApp();\n\n  const dragManager = new DragManager();\n  const pixiText = new PIXI.Text(text, { ...textStyle, fontSize, fill });\n\n  export const pixiObj = pixiText;\n\n  let container,\n    showHelper = false;\n\n  pixiStore.editMode.subscribe((value) => {\n    showHelper = value;\n    !!container && container.showHelper(value);\n  });\n\n  $: {\n    pixiText.tint = fill;\n  }\n\n  onMount(() => {\n    let bg = new PIXI.Graphics();\n    bg.lineStyle(0);\n    bg.drawRect(0, 0, width, height);\n    bg.addChild(pixiText);\n\n    container = new WarpContainer(bg, app.renderer, app.screen, showHelper);\n    container.x = x;\n    container.y = y;\n\n    dragManager.makeDraggable(container.group, container.sprite);\n    app.stage.addChild(container.group);\n\n    const update = () => {\n      pixiText.text = text;\n      pixiText.alpha = style.opacity;\n      pixiText.setTransform(\n        width / 2 - (fontSize * style.scale) / 2,\n        height / 2 - (fontSize * style.scale) / 2,\n        style.scale,\n        style.scale,\n      );\n      container.update();\n    };\n\n    app.ticker.add(update);\n\n    pixiStore.destructors.update((current) => [\n      ...current,\n      () => {\n        app.ticker.remove(update, this);\n        console.log('TextElement destroyed');\n      },\n    ]);\n\n    // return () => {\n    //   console.log('TextElement destroy');\n    //   app.ticker.remove(update);\n    // };\n  });\n</script>\n","<script>\n  import { Canvas, Screen, SketchWrapper } from '@mmmapper/components';\n  import { TextElement } from '@mmmapper/components';\n\n  let canvas;\n\n  let texts = [\n    {\n      value: 'hello hello',\n      x: 250,\n      y: 100,\n      width: 200,\n      height: 50,\n      fontSize: 20,\n      fill: 0x000000,\n      style: { opacity: 1, scale: 1 },\n    },\n    {\n      value: 'あ',\n      x: 250,\n      y: 200,\n      width: 100,\n      height: 100,\n      fontSize: 60,\n      fill: 0xffffff,\n      style: { opacity: 1, scale: 1.5 },\n      textStyle: { lineJoin: 'bevel', strokeThickness: 2, fill: 0xffffff },\n    },\n  ];\n</script>\n\n# TextElement\n\nA text element.\n\n<Canvas\n  bind:canvas={canvas}\n  width=\"600\"\n  height=\"400\"\n  class=\"border shadow mx-auto\"\n>\n  <Screen canvas={canvas} width=\"600\" height=\"400\" editMode={true}>\n    <SketchWrapper>\n      {#each texts as text}\n        <TextElement\n          text={text.value}\n          style={text.style}\n          x={text.x}\n          y={text.y}\n          width={text.width}\n          height={text.height}\n          fontSize={text.fontSize}\n          fill={text.fill}\n          textStyle={text.textStyle} />\n      {/each}\n    </SketchWrapper>\n  </Screen>\n</Canvas>\n\n```\n<script>\n<script>\n  import { Canvas, Screen, SketchWrapper } from '@mmmapper/components';\n  import { TextElement } from '@mmmapper/components';\n\n  let canvas;\n\n  let texts = [\n    {\n      value: 'hello hello',\n      x: 250,\n      y: 100,\n      width: 200,\n      height: 50,\n      fontSize: 20,\n      fill: 0x000000,\n      style: { opacity: 1, scale: 1 },\n    },\n    {\n      value: 'あ',\n      x: 250,\n      y: 200,\n      width: 100,\n      height: 100,\n      fontSize: 60,\n      fill: 0xffffff,\n      style: { opacity: 1, scale: 1.5 },\n      textStyle: { lineJoin: 'bevel', strokeThickness: 2, fill: 0xffffff },\n    },\n  ];\n</script>\n\n<Canvas\n  bind:canvas={canvas}\n  width=\"600\"\n  height=\"400\"\n  class=\"border shadow mx-auto\"\n>\n  <Screen canvas={canvas} width=\"600\" height=\"400\" editMode={true}>\n    <SketchWrapper>\n      {#each texts as text}\n        <TextElement\n          text={text.value}\n          style={text.style}\n          x={text.x}\n          y={text.y}\n          width={text.width}\n          height={text.height}\n          fontSize={text.fontSize}\n          fill={text.fill}\n          textStyle={text.textStyle} />\n      {/each}\n    </SketchWrapper>\n  </Screen>\n</Canvas>\n```"],"names":["text","x","y","width","height","style","opacity","scale","textStyle","fontSize","fill","getApp","pixiStore","getContext","PIXI_CONTEXT","app","dragManager","DragManager","pixiText","PIXI","Text","pixiObj","container","showHelper","editMode","subscribe","value","onMount","bg","Graphics","lineStyle","drawRect","addChild","WarpContainer","renderer","screen","makeDraggable","group","sprite","stage","update","alpha","setTransform","ticker","add","destructors","current","remove","this","console","log","tint","ctx","length","canvas","lineJoin","strokeThickness"],"mappings":"2UAKaA,QACTC,QACAC,YACAC,aACAC,YACAC,GACEC,QAAS,EACTC,MAAO,iBAETC,kBACAC,EAAW,YACXC,EAAO,kBAEDC,EAAMC,UAAEA,GAAcC,EAAWC,GACnCC,EAAMJ,IAENK,MAAkBC,EAClBC,MAAeC,EAAKC,KAAKpB,MAAWQ,EAAWC,SAAAA,EAAUC,KAAAA,IAElDW,EAAUH,MAEnBI,EACFC,GAAa,SAEfX,EAAUY,SAASC,WAAWC,IAC5BH,EAAaG,EACXJ,GAAaA,EAAUC,WAAWG,MAOtCC,YACMC,MAAST,EAAKU,SAClBD,EAAGE,UAAU,GACbF,EAAGG,SAAS,EAAG,EAAG5B,EAAOC,GACzBwB,EAAGI,SAASd,GAEZI,MAAgBW,EAAcL,EAAIb,EAAImB,SAAUnB,EAAIoB,OAAQZ,GAC5DD,EAAUrB,EAAIA,EACdqB,EAAUpB,EAAIA,EAEdc,EAAYoB,cAAcd,EAAUe,MAAOf,EAAUgB,QACrDvB,EAAIwB,MAAMP,SAASV,EAAUe,aAEvBG,OACJtB,EAASlB,KAAOA,EAChBkB,EAASuB,MAAQpC,EAAMC,QACvBY,EAASwB,aACPvC,EAAQ,EAAKM,EAAWJ,EAAME,MAAS,EACvCH,EAAS,EAAKK,EAAWJ,EAAME,MAAS,EACxCF,EAAME,MACNF,EAAME,OAERe,EAAUkB,UAGZzB,EAAI4B,OAAOC,IAAIJ,GAEf5B,EAAUiC,YAAYL,QAAQM,OACzBA,OAED/B,EAAI4B,OAAOI,OAAOP,EAAQQ,MAC1BC,QAAQC,IAAI,uUAlChBhC,EAASiC,KAAOzC,sTCUJ0C,KAAK1B,YACJ0B,KAAK/C,QACT+C,KAAKnD,IACLmD,KAAKlD,QACDkD,KAAKjD,aACJiD,KAAKhD,gBACHgD,KAAK3C,cACT2C,KAAK1C,eACA0C,KAAK5C,qKAVb4C,0BAALC,sNAAKD,aAALC,6HAAAA,8DAAAA,ybAFUD,wCAA2C,yHAA3CA,2TALHA,gBAAAA,49DAAAA,ucA/BTE,aAIA5B,MAAO,cACPzB,EAAG,IACHC,EAAG,IACHC,MAAO,IACPC,OAAQ,GACRK,SAAU,GACVC,KAAM,EACNL,OAASC,QAAS,EAAGC,MAAO,KAG5BmB,MAAO,IACPzB,EAAG,IACHC,EAAG,IACHC,MAAO,IACPC,OAAQ,IACRK,SAAU,GACVC,KAAM,SACNL,OAASC,QAAS,EAAGC,MAAO,KAC5BC,WAAa+C,SAAU,QAASC,gBAAiB,EAAG9C,KAAM,wBASjD4C"}