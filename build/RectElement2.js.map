{"version":3,"file":"RectElement2.js","sources":["../../../src/elements/RectElement.svelte"],"sourcesContent":["<script>\n  import { getContext, onDestroy } from 'svelte';\n\n  import PIXI, {\n    PIXI_CONTEXT,\n    DragManager,\n    WarpContainer,\n  } from '../lib/pixi';\n\n  /* Args */\n  export let x = 0,\n    y = 0,\n    offset = [],\n    width,\n    height,\n    fill = 0xffffff,\n    brightness = null,\n    filters = [],\n    scale = 1,\n    position = 'center',\n    lineWidth = null,\n    lineColor = null;\n\n  const { getApp, pixiStore } = getContext(PIXI_CONTEXT);\n  const app = getApp();\n\n  const dragManager = new DragManager();\n\n  function getTransform(position, scale, obj, width, height) {\n    let transform = () => {};\n\n    if (position === 'center') {\n      transform = () => {\n        obj.setTransform(\n          (1 + width - width * scale) / 2,\n          (1 + height - height * scale) / 2,\n          scale,\n          scale,\n        );\n      };\n    } else if (position === 'bottom') {\n      transform = () => {\n        obj.setTransform(0, height - height * scale, 1, scale);\n      };\n    }\n    return transform;\n  }\n\n  let container,\n    showHelper = false;\n  let rect;\n\n  pixiStore.editMode.subscribe((value) => {\n    showHelper = value;\n    !!container && container.showHelper(value);\n  });\n\n  function setup() {\n    let bg = new PIXI.Graphics();\n    if (lineWidth) {\n      bg.lineStyle(lineWidth, lineColor);\n      bg.drawRect(0, 0, width, height);\n    }\n\n    rect = new PIXI.Graphics();\n    rect.lineStyle(0);\n    rect.beginFill(fill, 1).drawRect(0, 0, width, height).endFill();\n    rect.filters = filters;\n    bg.addChild(rect);\n\n    container = new WarpContainer(bg, app.renderer, app.screen, showHelper);\n    container.x = x;\n    container.y = y;\n\n    container.setOffset(...offset);\n\n    dragManager.makeDraggable(container.group, container.sprite);\n    app.stage.addChild(container.group);\n\n    const transform = getTransform(position, scale, rect, width, height);\n\n    let r, g, b;\n\n    const update = () => {\n      container.update();\n      transform();\n      if (brightness) {\n        r = Math.ceil((fill >> 16) * brightness);\n        g = Math.ceil(((fill >> 8) & 255) * brightness);\n        b = Math.ceil((fill & 255) * brightness);\n        rect.tint = ((1 << 24) + (r << 16) + (g << 8) + b) & 0xffffff;\n      }\n    };\n\n    app.ticker.add(update);\n\n    onDestroy(() => {\n      app.ticker.remove(update);\n    });\n  }\n\n  setup();\n</script>\n"],"names":[],"mappings":"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"}